Клиент должен генерировать заголовок X-Request-Idempotency. На сервере используется хранилище с уже использованными ключами идемпотентности. Если приходит запрос с ключом в хранилище, запрос отклоняется с кодом 400.
 
Хранилище ключей реализовано в памяти приложения, поэтому в распределенной системе работает не эффективно. 
Для распределенной реализации нужно централизованное хранилище, используемое всеми экземплярами приложения.
Кроме того момент проверки на наличие ключа идемпотентности и вставка записи заказа в базу должны проходить в одной транзакции (атомарно). 
В этом случае исключаются гонки между инстансами. 

```
helm install auth  ..\Auth\chart\ --namespace auth --create-namespace
helm install orders  .\chart\ --namespace idempotency --create-namespace
```
Запуск тестов
```
newman run .\postman_collection.json
```